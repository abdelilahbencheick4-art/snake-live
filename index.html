<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake AI Smart</title>

<style>
html,body{
margin:0;
height:100%;
background:#111;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
font-family:Arial;
overflow:hidden;
}

#scoreBoard{
color:white;
font-size:20px;
margin-bottom:10px;
}

canvas{
border:4px solid #4CAF50;
border-radius:20px;
box-shadow:0 0 40px rgba(76,175,80,.6);
max-width:95vw;
max-height:80vh;
}
</style>
</head>
<body>

<div id="scoreBoard">Score: <span id="score">0</span></div>
<canvas id="game"></canvas>

<script>

const TILE=20;
const COLS=20;
const ROWS=20;

const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

canvas.width=TILE*COLS;
canvas.height=TILE*ROWS;

let snake=[];
let apple={};
let score=0;

const SPEED=60;

// INIT
function init(){
let midX=Math.floor(COLS/2);
let midY=Math.floor(ROWS/2);

snake=[
{x:midX,y:midY},
{x:midX,y:midY+1},
{x:midX,y:midY+2}
];

score=0;
spawnApple();
updateScore();
}

function spawnApple(){
do{
apple={
x:Math.floor(Math.random()*COLS),
y:Math.floor(Math.random()*ROWS)
};
}while(snake.some(s=>s.x===apple.x && s.y===apple.y));
}

// BFS PATHFINDING
function bfs(start,target,body){

let queue=[[start]];
let visited=new Set();
visited.add(start.x+","+start.y);

while(queue.length>0){

let path=queue.shift();
let current=path[path.length-1];

if(current.x===target.x && current.y===target.y){
return path.slice(1);
}

let moves=[
{x:0,y:-1},
{x:0,y:1},
{x:-1,y:0},
{x:1,y:0}
];

for(let m of moves){

let nx=current.x+m.x;
let ny=current.y+m.y;

if(nx<0||ny<0||nx>=COLS||ny>=ROWS) continue;

let key=nx+","+ny;
if(visited.has(key)) continue;

let collision=body.some(b=>b.x===nx&&b.y===ny);

if(!collision){
visited.add(key);
queue.push([...path,{x:nx,y:ny}]);
}
}
}
return null;
}

// IA PRINCIPALE
function getMove(){

let head=snake[0];

// 1️⃣ Essayer chemin vers pomme
let path=bfs(head,apple,snake.slice(0,-1));

if(path && path.length>0){

// Simuler mouvement pour vérifier que ça ne bloque pas
let newSnake=[path[0],...snake];
newSnake.pop();

let pathToTail=bfs(path[0],newSnake[newSnake.length-1],newSnake.slice(0,-1));

if(pathToTail){
return {
x:path[0].x-head.x,
y:path[0].y-head.y
};
}
}

// 2️⃣ Sinon suivre la queue
let tail=snake[snake.length-1];
let safePath=bfs(head,tail,snake.slice(0,-1));

if(safePath && safePath.length>0){
return {
x:safePath[0].x-head.x,
y:safePath[0].y-head.y
};
}

// 3️⃣ Dernier recours : mouvement libre
let moves=[
{x:0,y:-1},
{x:0,y:1},
{x:-1,y:0},
{x:1,y:0}
];

for(let m of moves){
let nx=head.x+m.x;
let ny=head.y+m.y;
if(nx>=0&&ny>=0&&nx<COLS&&ny<ROWS &&
!snake.some(s=>s.x===nx&&s.y===ny)){
return m;
}
}

return {x:0,y:-1};
}

// UPDATE LOOP
function update(){

let move=getMove();

let head={
x:snake[0].x+move.x,
y:snake[0].y+move.y
};

// collision murs
if(head.x<0||head.y<0||head.x>=COLS||head.y>=ROWS){
init();
return;
}

// collision corps
if(snake.some(s=>s.x===head.x&&s.y===head.y)){
init();
return;
}

snake.unshift(head);

// manger
if(head.x===apple.x && head.y===apple.y){
score++;
updateScore();
spawnApple();
}else{
snake.pop();
}

draw();
}

// DRAW
function draw(){

for(let y=0;y<ROWS;y++){
for(let x=0;x<COLS;x++){
ctx.fillStyle=(x+y)%2?"#2a2a2a":"#333";
ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
}
}

ctx.fillStyle="red";
ctx.beginPath();
ctx.arc(
apple.x*TILE+TILE/2,
apple.y*TILE+TILE/2,
TILE/2-3,
0,Math.PI*2
);
ctx.fill();

ctx.lineWidth=TILE-6;
ctx.lineCap="round";
ctx.lineJoin="round";
ctx.strokeStyle="#4CAF50";

ctx.beginPath();
ctx.moveTo(
snake[0].x*TILE+TILE/2,
snake[0].y*TILE+TILE/2
);

for(let i=1;i<snake.length;i++){
ctx.lineTo(
snake[i].x*TILE+TILE/2,
snake[i].y*TILE+TILE/2
);
}

ctx.stroke();

// yeux
ctx.fillStyle="white";
ctx.beginPath();
ctx.arc(snake[0].x*TILE+TILE/2-3,snake[0].y*TILE+TILE/2-3,2,0,Math.PI*2);
ctx.arc(snake[0].x*TILE+TILE/2+3,snake[0].y*TILE+TILE/2-3,2,0,Math.PI*2);
ctx.fill();
}

function updateScore(){
document.getElementById("score").innerText=score;
}

init();
setInterval(update,SPEED);

</script>
</body>
</html>
